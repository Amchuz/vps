import datetime

CATEGORIES = [
    {
        'id': 1,
        'name': 'person',
        'supercategory': 'human',
        'isthing':1,
        'instance_eval':1,
        'trainid':11,
        'ori_id':24,
        'color': [220,20,60],
    },
    {
        'id': 2,
        'name': 'rider',
        'supercategory': 'human',
        'isthing':1,
        'instance_eval':1,
        'trainid':12,
        'ori_id':25,
        'color': [255,0,0],
    },
    {
        'id': 3,
        'name': 'car',
        'supercategory': 'object',
        'isthing':1,
        'instance_eval':1,
        'trainid':13,
        'ori_id':26,
        'color': [0,0,142],
    },
    {
        'id': 4,
        'name': 'truck',
        'supercategory': 'vehicle',
        'isthing':1,
        'instance_eval':1,
        'trainid':14,
        'ori_id':27,
        'color': [0,0,70],
    },
    {
        'id': 5,
        'name': 'bus',
        'supercategory': 'vehicle',
        'isthing':1,
        'instance_eval':1,
        'trainid':15,
        'ori_id':28,
        'color': [0,60,100],
    },
    {
        'id': 6,
        'name': 'train',
        'supercategory': 'vehicle',
        'isthing':1,
        'instance_eval':1,
        'trainid':16,
        'ori_id':31,
        'color': [0,80,100],
    },
    {
        'id': 7,
        'name': 'motorcycle',
        'supercategory': 'vehicle',
        'isthing':1,
        'instance_eval':1,
        'trainid':17,
        'ori_id':32,
        'color': [0,0,230],
    },
    {
        'id': 8,
        'name': 'bicycle',
        'supercategory': 'vehicle',
        'isthing':1,
        'instance_eval':1,
        'trainid':18,
        'ori_id':33,
        'color': [119,11,32],
    },


    {
        'id': 9,
        'name': 'road',
        'supercategory': 'flat',
        'isthing':0,
        'instance_eval':0,
        'trainid':0,
        'ori_id':7,
        'color': [128,64,128],
    },
    {
        'id': 10,
        'name': 'sidewalk',
        'supercategory': 'flat',
        'isthing':0,
        'instance_eval':0,
        'trainid':1,
        'ori_id':8,
        'color': [244,35,232],
    },
    {
        'id': 11,
        'name': 'building',
        'supercategory': 'construction',
        'isthing':0,
        'instance_eval':0,
        'trainid':2,
        'ori_id':11,
        'color': [70,70,70],
    },
    {
        'id': 12,
        'name': 'wall',
        'supercategory': 'construction',
        'isthing':0,
        'instance_eval':0,
        'trainid':3,
        'ori_id':12,
        'color': [102,102,156],
    },
    {
        'id': 13,
        'name': 'fence',
        'supercategory': 'construction',
        'isthing':0,
        'instance_eval':0,
        'trainid':4,
        'ori_id':13,
        'color': [190,153,153],
    },
    {
        'id': 14,
        'name': 'pole',
        'supercategory': 'object',
        'isthing':0,
        'instance_eval':0,
        'trainid':5,
        'ori_id':17,
        'color': [153,153,153],
    },
    {
        'id': 15,
        'name': 'traffic_light',
        'supercategory': 'object',
        'isthing':0,
        'instance_eval':0,
        'trainid':6,
        'ori_id':19,
        'color': [250,170,30],
    },
    {
        'id': 16,
        'name': 'traffic_sign',
        'supercategory': 'object',
        'isthing':0,
        'instance_eval':0,
        'trainid':7,
        'ori_id':20,
        'color': [220,220,0],
    },
    {
        'id': 17,
        'name': 'vegetation',
        'supercategory': 'nature',
        'isthing':0,
        'instance_eval':0,
        'trainid':8,
        'ori_id':21,
        'color': [107,142,35],
    },
    {
        'id': 18,
        'name': 'terrain',
        'supercategory': 'nature',
        'isthing':0,
        'instance_eval':0,
        'trainid':9,
        'ori_id':22,
        'color': [152,251,152],
    },
    {
        'id': 19,
        'name': 'sky',
        'supercategory': 'sky',
        'isthing':0,
        'instance_eval':0,
        'trainid':10,
        'ori_id':23,
        'color': [70,130,180],
    }
]


COLOR2LABEL = {
    (0,0,0): 255,
    (111,74,0): 255,
    (70,130,180): 10,
    (128,64,128): 11,
    (244,35,232): 12,
    (230,150,140): 255,
    (152,251,152): 13,
    (87,182,35): 14,
    (35,142,35): 15,
    (70,70,70): 16,
    (153,153,153): 17,
    (190,153,153): 18,
    (150,20,20): 19,
    (250,170,30): 0,
    (220,220,0): 20,
    (180,180,100): 21,
    (173,153,153): 1,
    (168,153,153): 2,
    (81,0,21): 22,
    (81,0,81): 3,
    (220,20,60): 4,
    (255,0,0): 255,
    (119,11,32): 255,
    (0,0,230): 5,
    (0,0,142): 6,
    (0,80,100): 7,
    (0,60,100): 8,
    (0,0,70): 9,
    (0,0,90): 255,
    (0,80,100): 255,
    (0,100,100): 255,
    (50,0,90): 255,
}


COLOR2LABEL_ = {
    (0,0,0): 255,
    (111,74,0): 255,
    (70,130,180): 0,
    (128,64,128): 1,
    (244,35,232): 2,
    (230,150,140): 255,
    (152,251,152): 3,
    (87,182,35): 4,
    (35,142,35): 5,
    (70,70,70): 6,
    (153,153,153): 7,
    (190,153,153): 8,
    (150,20,20): 9,
    (250,170,30): 10,
    (220,220,0): 11,
    (180,180,100): 12,
    (173,153,153): 13,
    (168,153,153): 14,
    (81,0,21): 15,
    (81,0,81): 16,
    (220,20,60): 17,
    (255,0,0): 255,
    (119,11,32): 255,
    (0,0,230): 18,
    (0,0,142): 19,
    (0,80,100): 20,
    (0,60,100): 21,
    (0,0,70): 22,
    (0,0,90): 255,
    (0,80,100): 255,
    (0,100,100): 255,
    (50,0,90): 255,
}
import pdb

if __name__=="__main__":
    import json
    dict_name = 'panoptic_cityscapes_categories.json'
    # with open(dict_name, 'w') as f:
    #     json.dump(CATEGORIES,f)
    oriId2Id = {cat['ori_id']:cat['id'] for cat in CATEGORIES}
    with open('cityscapes_panoptic_val.json','r') as f:
        tmp = json.load(f)
    tmp['categories'] = CATEGORIES

    for ann in tmp['annotations']:
        for segm in ann['segments_info']:
            assert(segm['category_id'] in oriId2Id.keys())
            segm['category_id'] = oriId2Id[segm['category_id']]
        #ann['file_name'] = ann['file_name'].replace('gtFine_instanceIds','leftImg8bit')

    with open('panoptic_cityscapes_val.json','w') as f:
        json.dump(tmp, f)

